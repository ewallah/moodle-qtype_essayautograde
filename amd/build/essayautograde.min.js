define ("qtype_essayautograde/essayautograde",["jquery","core/str"],function(a,b){var c={plugin:"qtype_essayautograde",str:{},itemtype:"",itemmatch:"",minwords:0,maxwords:0,editortype:"",editormaxtries:50,editorinterval:100,responsesample:"",responseoriginal:""};c.init=function(a,b,d,e,f,g){var h="";switch(b){case"chars":h=".";break;case"words":h="\\w+";break;case"sentences":h="[^\\.?!]+[\\.?!]";break;case"paragraphs":h="[^\\r\\n]+[\\r\\n]*";break;}c.itemtype=b;c.itemmatch=new RegExp(h,"g");c.minwords=d;c.maxwords=e;c.editortype=f;if(a){c.setup_response_heights()}else{c.setup_itemcounts();c.setup_responsesample(g)}};c.setup_response_heights=function(){a("textarea.qtype_essay_response").each(function(){a(this).height(1);a(this).height(this.scrollHeight)})};c.setup_itemcounts=function(){a(".qtype_essay_response").each(function(){var b=c.get_itemcount_id(this),d=a.Deferred();c.check_editor(this,d);a.when(d).done(a.proxy(function(){c.create_itemcount(this,b);c.setup_itemcount(this,b)},this,b))})};c.check_editor=function(b,d){var e="";switch(c.editortype){case"atto":e="[contenteditable=true]";break;case"tinymce":e="iframe";break;}if(""==e){d.resolve()}else{var f=setInterval(function(){if(a(b).find(e).length){clearInterval(f);d.resolve()}},c.editorinterval)}};c.create_itemcount=function(a,d){if(null===document.getElementById(d)){var e=document.createElement("DIV");e.setAttribute("id",d);e.setAttribute("class","itemcount");if("words"==c.itemtype){b.get_strings([{key:"maxwordslabel",component:c.plugin},{key:"maxwordswarning",component:c.plugin},{key:"minwordslabel",component:c.plugin},{key:"minwordswarning",component:c.plugin},{key:"countwordslabel",component:c.plugin}]).done(function(a){c.str.maxwordslabel=a[0];c.str.maxwordswarning=a[1];c.str.minwordslabel=a[2];c.str.minwordswarning=a[3];c.str.countwordslabel=a[4];var d=document.createElement("B");d.setAttribute("class","label");d.appendChild(document.createTextNode(c.str.countwordslabel+": "));var f=document.createElement("I");f.setAttribute("class","value");f.appendChild(document.createTextNode("0"));var a=document.createElement("SPAN");a.setAttribute("class","wordswarning rounded bg-danger text-light ml-2 px-2 py-1 d-none");var g=document.createElement("P");g.setAttribute("class","countwords mt-2 mb-0");g.appendChild(d);g.appendChild(f);g.appendChild(a);e.appendChild(g);if(c.minwords){d=document.createElement("B");d.setAttribute("class","label");d.appendChild(document.createTextNode(c.str.minwordslabel+": "));f=document.createElement("I");f.setAttribute("class","value");f.appendChild(document.createTextNode(c.minwords));g=document.createElement("P");g.setAttribute("class","minwords my-0");g.appendChild(d);g.appendChild(f);e.appendChild(g)}if(c.maxwords){d=document.createElement("B");d.setAttribute("class","label");d.appendChild(document.createTextNode(c.str.maxwordslabel+": "));f=document.createElement("I");f.setAttribute("class","value");f.appendChild(document.createTextNode(c.maxwords));g=document.createElement("P");g.setAttribute("class","maxwords my-0");g.appendChild(d);g.appendChild(f);e.appendChild(g)}})}else{b.get_strings([{key:c.itemtype,component:c.plugin}]).done(function(a){c.str.countitems=a[0];var d=document.createElement("B");d.setAttribute("class","label");d.appendChild(document.createTextNode(c.str.countitems+": "));var b=document.createElement("I");b.setAttribute("class","value");b.appendChild(document.createTextNode("0"));var f=document.createElement("P");f.setAttribute("class","countitems my-0");f.appendChild(d);f.appendChild(b);e.appendChild(f)})}a.parentNode.insertBefore(e,a.nextSibling)}};c.setup_itemcount=function(b,d){var e=c.get_editable_element(b);if(e){a(e).keyup(function(){c.show_itemcount(this,d)});c.show_itemcount(e,d)}};c.get_editable_element=function(b){if("TEXTAREA"==a(b).prop("tagName")){return b}var c=a(b).find("[contenteditable=true]");if(c.length){return c.get(0)}var e=b.getElementsByTagName("IFRAME");if(e.length){e=e[0];var f=e.contentWindow||e.contentDocument;if(f.document){f=f.document}if(f.body&&f.body.isContentEditable){return f.body}}var c=a(b).find("textarea");if(c.length){return c.get(0)}return null};c.get_textarea=function(b){if("TEXTAREA"==a(b).prop("tagName")){return b}return a(b).find("textarea").get(0)};c.get_textarea_name=function(b){var d=c.get_textarea(b);return a(d).attr("name")};c.get_itemcount_id=function(a){var b=c.get_textarea_name(a);return"id_"+b+"_itemcount"};c.escaped_id=function(a){return"#"+a.replace(/(:|\.|\[|\]|,|=|@)/g,"\\$1")};c.show_itemcount=function(b,d){if("TEXTAREA"==a(b).prop("tagName")){var e=a(b).val().match(c.itemmatch)}else{var e=a(b).text().match(c.itemmatch)}if(e){e=e.length}else{e=0}d=c.escaped_id(d);if("words"==c.itemtype){a(d+" .countwords .value").text(e);var f="";if(e){if(c.minwords&&c.minwords>e){f=c.str.minwordswarning}if(c.maxwords&&c.maxwords<e){f=c.str.maxwordswarning}}var g=document.querySelector(d+" .countwords .wordswarning");if(g){g.innerText=f;if(""==f){g.classList.add("d-none")}else{g.classList.remove("d-none")}}}else{a(d+" .countitems .value").text(e)}};c.setup_responsesample=function(d){if(""==d){return}c.responsesample=d;b.get_strings([{key:"hidesample",component:c.plugin},{key:"showsample",component:c.plugin}]).done(function(b){c.str.hidesample=b[0];c.str.showsample=b[1];var d=a(".qtext").find("p:not(:empty), div:not(:empty)");if(d.length){d=d.last()}else{d=a(".qtext")}d.append(a("<span></span>").click(function(){var b="",d="",e=!1;if(a(this).hasClass("showsample")){a(this).removeClass("showsample").addClass("hidesample").text(c.str.hidesample);b=c.responsesample;e=!0}else{a(this).removeClass("hidesample").addClass("showsample").text(c.str.showsample);b=c.responseoriginal}var f=null,g=a(this).closest(".qtext");if("audio"==c.editortype||"video"==c.editortype){f=g.find(".audiovideo_response_prompt")}else{var h=g.next(".ablock").find(".answer .qtype_essay_response");if(h.is("[name$='_answer']")){f=h}else{f=h.find("[contenteditable=true]");if(0==f.length){f=h.find("iframe").contents().find("[contenteditable=true]");if(0==f.length){f=h.find("[name$='_answer']")}}}}if(null===f||0==f.length){return!1}if("TEXTAREA"==f.prop("tagName")){d=f.val();f.val(b).keyup()}else{d=f.text();f.text(b).keyup()}if(e){c.responseoriginal=d}return!0}).trigger("click"))})};return c});
//# sourceMappingURL=essayautograde.min.js.map
